<div class="content" [attr.lang]="document.language(field)">
    @if (showEntities) {
        @let value = document.namedEntityAnnotatedValue(field) || document.fieldValue(field);
        @for (p of splitParagraphs(value); track $index) {
            <p>
                @for (segment of p | annotationSegments; track $index) {
                    @let annotation = annotationName(segment.annotation);
                    @if (annotation) {
                        <mark class="entity-{{annotation}}">
                            {{segment.content}}
                            <fa-icon [icon]="entityIcons[annotation]"  class="entity-icon"/>
                        </mark>
                    } @else {
                        {{segment.content}}
                    }
                }
            </p>
        }
        <ia-entity-legend [annotatedContent]="value" />
    } @else {
        @let paragraphs = document.fieldValue(field) | paragraph;
        @for (p of paragraphs; track $index) {
            @let segments = p | elasticsearchHighlight:field:document | highlightSnippet;
            <p class="break-word" style="white-space: pre-wrap;">
                @for (segment of segments; track $index) {
                    @if (segment.highlight)
                    {<mark class="highlight" ngPreserveWhitespaces>{{segment.content}}</mark>}
                    @else
                    {<ng-container ngPreserveWhitespaces>{{segment.content}}</ng-container>}
                }
            </p>
        }
    }
</div>
